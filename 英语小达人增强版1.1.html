<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>è‹±è¯­å°è¾¾äººå¢å¼ºç‰ˆ - æ²ªæ•™ç‰ˆäºŒå¹´çº§è¶£å‘³å­¦ä¹ </title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Arial Rounded MT Bold', 'Helvetica Rounded', Arial, sans-serif;
            -webkit-tap-highlight-color: transparent;
        }
        
        body {
            background: linear-gradient(135deg, #6ecbf5 0%, #e2f0fd 100%);
            min-height: 100vh;
            padding: 15px;
            display: flex;
            flex-direction: column;
            align-items: center;
            overflow-x: hidden;
        }
        
        .container {
            max-width: 800px;
            width: 100%;
            background-color: white;
            border-radius: 20px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.15);
            overflow: hidden;
            position: relative;
            margin-top: 10px;
        }
        
        header {
            background: linear-gradient(90deg, #ff6b6b 0%, #ff8e53 100%);
            color: white;
            padding: 15px 20px;
            text-align: center;
            position: relative;
            border-bottom: 4px solid #ff4757;
        }
        
        h1 {
            font-size: 1.8rem;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.2);
            margin-bottom: 5px;
        }
        
        .subtitle {
            font-size: 0.95rem;
            opacity: 0.9;
        }
        
        .unit-selector {
            display: flex;
            justify-content: center;
            flex-wrap: wrap;
            gap: 8px;
            padding: 15px 10px;
            background-color: #f8f9fa;
            border-bottom: 2px solid #e9ecef;
        }
        
        .unit-btn {
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
            color: white;
            border: none;
            border-radius: 50px;
            padding: 10px 18px;
            font-size: 0.95rem;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
            font-weight: bold;
            display: flex;
            align-items: center;
            gap: 5px;
            flex: 1;
            min-width: 100px;
            max-width: 160px;
            text-align: center;
            justify-content: center;
        }
        
        .unit-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 12px rgba(0, 0, 0, 0.15);
        }
        
        .unit-btn.active {
            background: linear-gradient(135deg, #ff9a9e 0%, #fad0c4 100%);
            transform: scale(1.05);
        }
        
        .game-area {
            padding: 15px;
            min-height: 400px;
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        
        .game-title {
            font-size: 1.5rem;
            color: #ff6b6b;
            margin-bottom: 15px;
            text-align: center;
            padding: 0 10px;
        }
        
        .game-mode-selector {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin-bottom: 15px;
            width: 100%;
            flex-wrap: wrap;
        }
        
        .mode-btn {
            background: linear-gradient(135deg, #a1c4fd 0%, #c2e9fb 100%);
            border: none;
            border-radius: 30px;
            padding: 10px 20px;
            font-size: 1rem;
            cursor: pointer;
            transition: all 0.3s ease;
            color: #2c3e50;
            font-weight: bold;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
            flex: 1;
            max-width: 150px;
        }
        
        .mode-btn.active {
            background: linear-gradient(135deg, #ffb347 0%, #ffcc33 100%);
            transform: scale(1.05);
        }
        
        .card-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 12px;
            width: 100%;
            max-width: 600px;
            margin: 0 auto;
        }
        
        .card {
            background: linear-gradient(135deg, #a1c4fd 0%, #c2e9fb 100%);
            height: 90px;
            border-radius: 12px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
            position: relative;
            overflow: hidden;
        }
        
        .card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 16px rgba(0, 0, 0, 0.15);
        }
        
        .card-icon {
            font-size: 1.8rem;
            margin-bottom: 6px;
        }
        
        .card-text {
            font-size: 1rem;
            font-weight: bold;
            color: #2c3e50;
            text-align: center;
            padding: 0 5px;
        }
        
        .dialog-box {
            background-color: #fff9c4;
            border: 3px dashed #ffd54f;
            border-radius: 15px;
            padding: 15px;
            margin: 15px auto;
            max-width: 500px;
            width: 95%;
            position: relative;
        }
        
        .dialog-text {
            font-size: 1.2rem;
            text-align: center;
            margin-bottom: 12px;
            color: #5d4037;
            min-height: 50px;
            display: flex;
            align-items: center;
            justify-content: center;
            line-height: 1.4;
        }
        
        .answer-options {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            justify-content: center;
            margin-top: 15px;
        }
        
        .answer-btn {
            background: linear-gradient(135deg, #ffb347 0%, #ffcc33 100%);
            border: none;
            border-radius: 30px;
            padding: 10px 15px;
            font-size: 0.95rem;
            cursor: pointer;
            transition: all 0.3s ease;
            color: #5d4037;
            font-weight: bold;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
            flex: 1;
            min-width: 120px;
            max-width: 200px;
        }
        
        .answer-btn:hover {
            transform: scale(1.05);
            box-shadow: 0 6px 12px rgba(0, 0, 0, 0.15);
        }
        
        .feedback {
            font-size: 1.1rem;
            text-align: center;
            margin-top: 15px;
            font-weight: bold;
            min-height: 35px;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 0 10px;
        }
        
        .correct {
            color: #2ecc71;
        }
        
        .incorrect {
            color: #e74c3c;
        }
        
        .progress-container {
            width: 95%;
            max-width: 500px;
            height: 18px;
            background-color: #e0e0e0;
            border-radius: 10px;
            margin: 15px auto;
            overflow: hidden;
        }
        
        .progress-bar {
            height: 100%;
            background: linear-gradient(90deg, #4cd964 0%, #5ac8fa 100%);
            border-radius: 10px;
            transition: width 0.5s ease;
        }
        
        .speaker-btn {
            background-color: #5ac8fa;
            border: none;
            border-radius: 50%;
            width: 45px;
            height: 45px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            position: absolute;
            right: 15px;
            bottom: 15px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
            transition: all 0.3s ease;
            z-index: 100;
            font-size: 1.2rem;
        }
        
        .speaker-btn:hover {
            transform: scale(1.1);
            background-color: #4cd964;
        }
        
        .character {
            position: absolute;
            bottom: 15px;
            left: 15px;
            width: 70px;
            height: 90px;
            background: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><circle cx="50" cy="30" r="20" fill="%23FFD54F"/><circle cx="40" cy="25" r="3" fill="%235D4037"/><circle cx="60" cy="25" r="3" fill="%235D4037"/><path d="M45 35 Q50 40 55 35" stroke="%235D4037" stroke-width="2" fill="none"/><rect x="35" y="50" width="30" height="40" rx="5" fill="%234CAF50"/></svg>') no-repeat center;
            background-size: contain;
            z-index: 10;
        }
        
        .instructions {
            background: white;
            border-radius: 15px;
            padding: 15px;
            margin-top: 15px;
            box-shadow: 0 4px 10px rgba(0,0,0,0.1);
            width: 95%;
            max-width: 500px;
        }
        
        .instructions h3 {
            color: #ff6b6b;
            margin-bottom: 10px;
            text-align: center;
        }
        
        .instructions ul {
            padding-left: 20px;
            font-size: 0.9rem;
            color: #555;
        }
        
        .instructions li {
            margin-bottom: 8px;
            line-height: 1.4;
        }
        
        .wechat-note {
            background: #fffde7;
            border: 1px solid #ffd54f;
            border-radius: 10px;
            padding: 10px 15px;
            margin-top: 15px;
            text-align: center;
            font-size: 0.85rem;
            color: #5d4037;
            max-width: 500px;
        }
        
        .game-info {
            display: flex;
            justify-content: space-between;
            width: 95%;
            max-width: 500px;
            margin: 10px auto;
            font-size: 0.9rem;
            color: #555;
        }
        
        .score {
            background: #e3f2fd;
            padding: 5px 15px;
            border-radius: 20px;
            font-weight: bold;
        }
        
        .level {
            background: #ffecb3;
            padding: 5px 15px;
            border-radius: 20px;
            font-weight: bold;
        }
        
        /* æ–°å¢æ‹¼å†™åŒºåŸŸæ ·å¼ */
        .spelling-container {
            width: 100%;
            max-width: 500px;
            margin: 20px auto;
            text-align: center;
        }
        
        .spelling-prompt {
            font-size: 1.4rem;
            margin-bottom: 20px;
            color: #ff6b6b;
            font-weight: bold;
        }
        
        .spelling-input {
            width: 100%;
            padding: 12px;
            font-size: 1.2rem;
            border: 2px solid #4facfe;
            border-radius: 10px;
            text-align: center;
            margin-bottom: 15px;
        }
        
        .spelling-input:focus {
            outline: none;
            border-color: #ff6b6b;
            box-shadow: 0 0 0 3px rgba(255, 107, 107, 0.3);
        }
        
        .spelling-hint {
            font-size: 1rem;
            color: #777;
            margin-bottom: 15px;
        }
        
        .spelling-buttons {
            display: flex;
            gap: 10px;
            justify-content: center;
            margin-top: 10px;
        }
        
        .spelling-btn {
            padding: 10px 20px;
            border: none;
            border-radius: 30px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .check-btn {
            background: linear-gradient(135deg, #4cd964 0%, #5ac8fa 100%);
            color: white;
        }
        
        .skip-btn {
            background: linear-gradient(135deg, #ffb347 0%, #ffcc33 100%);
            color: white;
        }
        
        .spelling-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        }
        
        /* å¡«ç©ºç»ƒä¹ æ ·å¼ */
        .fill-container {
            width: 100%;
            max-width: 500px;
            margin: 20px auto;
            text-align: center;
        }
        
        .sentence {
            font-size: 1.4rem;
            margin-bottom: 20px;
            color: #2c3e50;
            line-height: 1.6;
        }
        
        .blank {
            display: inline-block;
            min-width: 80px;
            border-bottom: 3px dashed #ff6b6b;
            margin: 0 5px;
            position: relative;
            vertical-align: middle;
        }
        
        .blank-answer {
            position: absolute;
            bottom: -5px;
            left: 0;
            width: 100%;
            text-align: center;
            color: #e74c3c;
            font-weight: bold;
            font-size: 1.1rem;
        }
        
        .fill-options {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 10px;
            margin-top: 20px;
        }
        
        .fill-option {
            background: linear-gradient(135deg, #a1c4fd 0%, #c2e9fb 100%);
            border: none;
            border-radius: 30px;
            padding: 10px 20px;
            font-size: 1rem;
            cursor: pointer;
            transition: all 0.3s ease;
            color: #2c3e50;
            font-weight: bold;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        }
        
        .fill-option:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 12px rgba(0, 0, 0, 0.15);
        }
        
        .fill-option.selected {
            background: linear-gradient(135deg, #ffb347 0%, #ffcc33 100%);
            transform: scale(1.05);
            color: white;
        }
        
        /* è¯­éŸ³çŠ¶æ€æç¤º */
        .voice-status {
            position: absolute;
            top: 15px;
            right: 15px;
            background: rgba(255, 255, 255, 0.8);
            border-radius: 20px;
            padding: 5px 12px;
            font-size: 0.8rem;
            display: flex;
            align-items: center;
            gap: 5px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
        
        .voice-status.speaking {
            color: #2ecc71;
        }
        
        .voice-status.muted {
            color: #e74c3c;
        }
        
        .voice-icon {
            font-size: 1rem;
        }
        
        /* è¯­éŸ³æ³¢åŠ¨åŠ¨ç”» */
        @keyframes wave {
            0%, 100% { height: 5px; }
            50% { height: 15px; }
        }
        
        .voice-animation {
            display: flex;
            align-items: flex-end;
            gap: 2px;
            height: 20px;
        }
        
        .voice-bar {
            width: 3px;
            background: #4cd964;
            border-radius: 3px;
        }
        
        .voice-bar:nth-child(1) { animation: wave 1s infinite 0s; }
        .voice-bar:nth-child(2) { animation: wave 1s infinite 0.2s; }
        .voice-bar:nth-child(3) { animation: wave 1s infinite 0.4s; }
        .voice-bar:nth-child(4) { animation: wave 1s infinite 0.6s; }
        .voice-bar:nth-child(5) { animation: wave 1s infinite 0.8s; }
        
        /* æ–°å¢å¡ç‰‡ç¿»è½¬æ•ˆæœ */
        .card.flipped .card-back {
            transform: rotateY(0deg);
        }
        
        .card.flipped .card-front {
            transform: rotateY(180deg);
        }
        
        .card-inner {
            position: relative;
            width: 100%;
            height: 100%;
            text-align: center;
            transition: transform 0.6s;
            transform-style: preserve-3d;
        }
        
        .card-front, .card-back {
            position: absolute;
            width: 100%;
            height: 100%;
            backface-visibility: hidden;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
        }
        
        .card-back {
            background: linear-gradient(135deg, #ff9a9e 0%, #fad0c4 100%);
            transform: rotateY(180deg);
        }
        
        .card-back .card-icon {
            color: #d63031;
        }
        
        /* å•è¯å¡ç‰‡æ ‡ç­¾ */
        .card-tag {
            position: absolute;
            top: 5px;
            right: 5px;
            background: rgba(255, 255, 255, 0.7);
            border-radius: 10px;
            padding: 2px 8px;
            font-size: 0.7rem;
            font-weight: bold;
        }
        
        /* æ–°å¢æ‘‡åŠ¨åŠ¨ç”» */
        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            10%, 30%, 50%, 70%, 90% { transform: translateX(-5px); }
            20%, 40%, 60%, 80% { transform: translateX(5px); }
        }
        
        .shake {
            animation: shake 0.5s;
        }
        
        @media (max-width: 600px) {
            .card-grid {
                grid-template-columns: repeat(3, 1fr);
            }
            
            h1 {
                font-size: 1.6rem;
            }
            
            .card {
                height: 80px;
            }
            
            .card-icon {
                font-size: 1.5rem;
            }
            
            .card-text {
                font-size: 0.9rem;
            }
            
            .dialog-text {
                font-size: 1.1rem;
            }
            
            .unit-btn {
                padding: 8px 12px;
                font-size: 0.9rem;
            }
            
            .game-mode-selector {
                gap: 8px;
            }
            
            .mode-btn {
                padding: 8px 12px;
                font-size: 0.9rem;
                min-width: 100px;
            }
            
            .spelling-prompt, .sentence {
                font-size: 1.2rem;
            }
            
            .fill-option {
                padding: 8px 15px;
                font-size: 0.9rem;
            }
            
            .voice-status {
                top: 5px;
                right: 5px;
                font-size: 0.7rem;
                padding: 3px 8px;
            }
        }
        
        @media (max-width: 400px) {
            .card-grid {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .unit-btn {
                min-width: 80px;
                padding: 7px 10px;
                font-size: 0.85rem;
            }
            
            .answer-btn {
                min-width: 100px;
                padding: 8px 10px;
                font-size: 0.85rem;
            }
            
            .mode-btn {
                padding: 6px 10px;
                font-size: 0.85rem;
                min-width: 80px;
            }
            
            .spelling-prompt, .sentence {
                font-size: 1.1rem;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>è‹±è¯­å°è¾¾äººå¢å¼ºç‰ˆ</h1>
            <div class="subtitle">æ²ªæ•™ç‰ˆäºŒå¹´çº§è‹±è¯­è¶£å‘³å­¦ä¹ </div>
            <div class="voice-status" id="voiceStatus">
                <span class="voice-icon">ğŸ”Š</span>
                <span id="statusText">è¯­éŸ³åŠŸèƒ½å·²å¯ç”¨</span>
                <div class="voice-animation" id="voiceAnimation">
                    <div class="voice-bar"></div>
                    <div class="voice-bar"></div>
                    <div class="voice-bar"></div>
                    <div class="voice-bar"></div>
                    <div class="voice-bar"></div>
                </div>
            </div>
        </header>
        
        <div class="unit-selector">
            <button class="unit-btn active" data-unit="1">
                <span>ğŸŒ</span> Unit 1
            </button>
            <button class="unit-btn" data-unit="2">
                <span>âœï¸</span> Unit 2
            </button>
            <button class="unit-btn" data-unit="3">
                <span>ğŸ‚</span> Unit 3
            </button>
            <button class="unit-btn" data-unit="4">
                <span>ğŸŒ™</span> Unit 4
            </button>
        </div>
        
        <div class="game-area">
            <h2 class="game-title">Unit 1: é—®å€™ä¸è‡ªæˆ‘ä»‹ç»</h2>
            
            <div class="game-mode-selector">
                <button class="mode-btn active" data-mode="vocab">å•è¯å­¦ä¹ </button>
                <button class="mode-btn" data-mode="dialog">å¯¹è¯ç»ƒä¹ </button>
                <button class="mode-btn" data-mode="game">äº’åŠ¨æ¸¸æˆ</button>
                <button class="mode-btn" data-mode="spelling">å•è¯æ‹¼å†™</button>
                <button class="mode-btn" data-mode="fill-in">å¥å‹å¡«ç©º</button>
            </div>
            
            <div class="game-info">
                <div class="score">ç§¯åˆ†: <span id="score">0</span></div>
                <div class="level">ç­‰çº§: <span id="level">åˆçº§</span></div>
            </div>
            
            <div class="card-grid">
                <!-- å¡ç‰‡å†…å®¹ç”±JSåŠ¨æ€ç”Ÿæˆ -->
            </div>
            
            <div class="dialog-box" id="dialogBox">
                <div class="dialog-text" id="question">Hello! How are you?</div>
                <div class="answer-options" id="answerOptions">
                    <!-- ç­”æ¡ˆé€‰é¡¹ç”±JSåŠ¨æ€ç”Ÿæˆ -->
                </div>
            </div>
            
            <!-- æ‹¼å†™ç»ƒä¹ åŒºåŸŸ -->
            <div class="spelling-container" id="spellingContainer" style="display: none;">
                <div class="spelling-prompt" id="spellingPrompt"></div>
                <input type="text" class="spelling-input" id="spellingInput" placeholder="è¯·è¾“å…¥å•è¯">
                <div class="spelling-hint" id="spellingHint"></div>
                <div class="spelling-buttons">
                    <button class="spelling-btn check-btn" id="checkSpelling">æ£€æŸ¥</button>
                    <button class="spelling-btn skip-btn" id="skipSpelling">è·³è¿‡</button>
                </div>
            </div>
            
            <!-- å¡«ç©ºç»ƒä¹ åŒºåŸŸ -->
            <div class="fill-container" id="fillContainer" style="display: none;">
                <div class="sentence" id="sentenceText"></div>
                <div class="fill-options" id="fillOptions"></div>
            </div>
            
            <div class="progress-container">
                <div class="progress-bar" id="progressBar" style="width: 0%"></div>
            </div>
            
            <div class="feedback" id="feedback"></div>
        </div>
        
        <button class="speaker-btn" id="speakerBtn">
            ğŸ”Š
        </button>
        
        <div class="character"></div>
    </div>

    <div class="instructions">
        <h3>æ¸¸æˆè¯´æ˜</h3>
        <ul>
            <li>é€‰æ‹©é¡¶éƒ¨ä¸åŒå•å…ƒå­¦ä¹ ä¸åŒä¸»é¢˜çš„è‹±è¯­å†…å®¹</li>
            <li>ä½¿ç”¨äº”ç§å­¦ä¹ æ¨¡å¼ï¼šå•è¯å­¦ä¹ ã€å¯¹è¯ç»ƒä¹ ã€äº’åŠ¨æ¸¸æˆã€å•è¯æ‹¼å†™å’Œå¥å‹å¡«ç©º</li>
            <li>åœ¨å•è¯æ‹¼å†™æ¨¡å¼ä¸‹ï¼Œæ ¹æ®æç¤ºæ‹¼å†™å•è¯</li>
            <li>åœ¨å¥å‹å¡«ç©ºæ¨¡å¼ä¸‹ï¼Œé€‰æ‹©æ­£ç¡®å•è¯å®Œæˆå¥å­</li>
            <li>ç‚¹å‡»å•è¯å¡ç‰‡å­¦ä¹ å‘éŸ³å’Œå«ä¹‰ï¼ˆç‚¹å‡»å¡ç‰‡å¯ç¿»è½¬ï¼‰</li>
            <li>åœ¨å¯¹è¯æ¡†ä¸­é€‰æ‹©æ­£ç¡®çš„å›ç­”å®Œæˆå¯¹è¯ç»ƒä¹ </li>
            <li>å³ä¸‹è§’å–‡å­å›¾æ ‡å¯ä»¥é‡å¤å¬é—®é¢˜</li>
            <li>è¿›åº¦æ¡æ˜¾ç¤ºä½ çš„å­¦ä¹ è¿›åº¦ï¼Œç§¯åˆ†å’Œç­‰çº§ä¼šéšç€å­¦ä¹ æé«˜</li>
        </ul>
    </div>
    
    <div class="wechat-note">
        æç¤ºï¼šåœ¨å¾®ä¿¡ä¸­é•¿æŒ‰æ­¤é¡µé¢ï¼Œé€‰æ‹©"åœ¨æµè§ˆå™¨æ‰“å¼€"ï¼Œå¯è·å¾—æœ€ä½³ä½“éªŒ
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // å…¨å±€å˜é‡
            let currentUnit = 1;
            let currentMode = 'vocab';
            let userScore = 0;
            let userLevel = 1;
            let speechSupported = ('speechSynthesis' in window);
            let currentSpellingWord = null;
            let currentFillQuestion = null;
            let isSpeaking = false;
            
            // DOMå…ƒç´ 
            const unitButtons = document.querySelectorAll('.unit-btn');
            const modeButtons = document.querySelectorAll('.mode-btn');
            const cardGrid = document.querySelector('.card-grid');
            const questionEl = document.getElementById('question');
            const answerOptionsEl = document.getElementById('answerOptions');
            const feedbackEl = document.getElementById('feedback');
            const progressBar = document.getElementById('progressBar');
            const speakerBtn = document.getElementById('speakerBtn');
            const scoreEl = document.getElementById('score');
            const levelEl = document.getElementById('level');
            const spellingContainer = document.getElementById('spellingContainer');
            const spellingPrompt = document.getElementById('spellingPrompt');
            const spellingInput = document.getElementById('spellingInput');
            const spellingHint = document.getElementById('spellingHint');
            const checkSpellingBtn = document.getElementById('checkSpelling');
            const skipSpellingBtn = document.getElementById('skipSpelling');
            const fillContainer = document.getElementById('fillContainer');
            const sentenceText = document.getElementById('sentenceText');
            const fillOptions = document.getElementById('fillOptions');
            const voiceStatus = document.getElementById('voiceStatus');
            const statusText = document.getElementById('statusText');
            const voiceAnimation = document.getElementById('voiceAnimation');
            
            // æ¸¸æˆæ•°æ® - åŒ…å«æ‰€æœ‰å•å…ƒçš„æ‰€æœ‰å•è¯å’Œå¥å­
            const gameData = {
                units: {
                    1: {
                        title: "Unit 1: é—®å€™ä¸è‡ªæˆ‘ä»‹ç»",
                        vocab: [
                            {icon: 'ğŸŒ', text: 'Good morning', word: 'morning', meaning: 'æ—©ä¸Šå¥½'},
                            {icon: 'â˜€ï¸', text: 'Good afternoon', word: 'afternoon', meaning: 'ä¸‹åˆå¥½'},
                            {icon: 'ğŸŒ‡', text: 'Good evening', word: 'evening', meaning: 'æ™šä¸Šå¥½'},
                            {icon: 'ğŸŒ™', text: 'Good night', word: 'night', meaning: 'æ™šå®‰'},
                            {icon: 'ğŸ˜Š', text: 'I\'m fine', word: 'fine', meaning: 'æˆ‘å¾ˆå¥½'},
                            {icon: 'ğŸ‘', text: 'Excellent', word: 'excellent', meaning: 'å¤ªæ£’äº†'},
                            {icon: 'ğŸ‘¦', text: 'Boy', word: 'boy', meaning: 'ç”·å­©'},
                            {icon: 'ğŸ‘§', text: 'Girl', word: 'girl', meaning: 'å¥³å­©'},
                            {icon: '1ï¸âƒ£', text: 'One', word: 'one', meaning: 'ä¸€'},
                            {icon: '2ï¸âƒ£', text: 'Two', word: 'two', meaning: 'äºŒ'},
                            {icon: '3ï¸âƒ£', text: 'Three', word: 'three', meaning: 'ä¸‰'},
                            {icon: '4ï¸âƒ£', text: 'Four', word: 'four', meaning: 'å››'},
                            {icon: '5ï¸âƒ£', text: 'Five', word: 'five', meaning: 'äº”'},
                            {icon: '6ï¸âƒ£', text: 'Six', word: 'six', meaning: 'å…­'},
                            {icon: '7ï¸âƒ£', text: 'Seven', word: 'seven', meaning: 'ä¸ƒ'},
                            {icon: '8ï¸âƒ£', text: 'Eight', word: 'eight', meaning: 'å…«'},
                            {icon: '9ï¸âƒ£', text: 'Nine', word: 'nine', meaning: 'ä¹'},
                            {icon: 'ğŸ”Ÿ', text: 'Ten', word: 'ten', meaning: 'å'},
                            {icon: 'âšª', text: 'White', word: 'white', meaning: 'ç™½è‰²'},
                            {icon: 'ğŸŸ£', text: 'Purple', word: 'purple', meaning: 'ç´«è‰²'},
                            {icon: 'ğŸ€', text: 'Pink', word: 'pink', meaning: 'ç²‰è‰²'},
                            {icon: 'ğŸŠ', text: 'Orange', word: 'orange', meaning: 'æ©™è‰²'},
                            {icon: 'ğŸŸ¤', text: 'Brown', word: 'brown', meaning: 'æ£•è‰²'},
                            {icon: 'âš«', text: 'Black', word: 'black', meaning: 'é»‘è‰²'},
                            // æ–°å¢å•è¯å¡ç‰‡
                            {icon: 'â¤ï¸', text: 'Red', word: 'red', meaning: 'çº¢è‰²'},
                            {icon: 'ğŸ’š', text: 'Green', word: 'green', meaning: 'ç»¿è‰²'},
                            {icon: 'ğŸ’›', text: 'Yellow', word: 'yellow', meaning: 'é»„è‰²'},
                            {icon: 'ğŸ’™', text: 'Blue', word: 'blue', meaning: 'è“è‰²'},
                            {icon: 'ğŸ‘©â€ğŸ«', text: 'Teacher', word: 'teacher', meaning: 'è€å¸ˆ'},
                            {icon: 'ğŸ‘¨â€ğŸ“', text: 'Student', word: 'student', meaning: 'å­¦ç”Ÿ'}
                        ],
                        dialogs: [
                            {
                                question: "Hello! How are you?",
                                answers: [
                                    {text: "I'm fine, thank you!", correct: true},
                                    {text: "Good morning!", correct: false},
                                    {text: "I'm a boy.", correct: false}
                                ]
                            },
                            {
                                question: "Are you a boy?",
                                answers: [
                                    {text: "Yes, I'm a boy.", correct: true},
                                    {text: "No, I'm a girl.", correct: false},
                                    {text: "I'm excellent!", correct: false}
                                ]
                            },
                            {
                                question: "What color is this?",
                                answers: [
                                    {text: "It's white.", correct: true},
                                    {text: "It's a bag.", correct: false},
                                    {text: "I like pink.", correct: false}
                                ]
                            }
                        ],
                        spelling: [
                            {hint: "æ—©ä¸Šå¥½", word: "morning"},
                            {hint: "ç”·å­©", word: "boy"},
                            {hint: "å¥³å­©", word: "girl"},
                            {hint: "æ•°å­—3", word: "three"},
                            {hint: "ç™½è‰²", word: "white"},
                            {hint: "é»‘è‰²", word: "black"},
                            {hint: "çº¢è‰²", word: "red"},
                            {hint: "è€å¸ˆ", word: "teacher"}
                        ],
                        fillIn: [
                            {
                                sentence: "Good ____, teacher!",
                                options: ["morning", "afternoon", "evening", "night"],
                                correct: "morning"
                            },
                            {
                                sentence: "I am a ____.",
                                options: ["boy", "girl", "student", "teacher"],
                                correct: "boy"
                            },
                            {
                                sentence: "The sky is ____.",
                                options: ["blue", "white", "black", "green"],
                                correct: "blue"
                            }
                        ]
                    },
                    2: {
                        title: "Unit 2: åŠ¨ä½œä¸èƒ½åŠ›",
                        vocab: [
                            {icon: 'ğŸƒ', text: 'Run', word: 'run', meaning: 'è·‘æ­¥'},
                            {icon: 'âœï¸', text: 'Write', word: 'write', meaning: 'å†™å­—'},
                            {icon: 'ğŸŠ', text: 'Swim', word: 'swim', meaning: 'æ¸¸æ³³'},
                            {icon: 'ğŸ¦…', text: 'Fly', word: 'fly', meaning: 'é£ç¿”'},
                            {icon: 'ğŸ¦¸', text: 'Supergirl', word: 'supergirl', meaning: 'è¶…çº§å¥³å­©'},
                            {icon: 'ğŸ›¹', text: 'Skate', word: 'skate', meaning: 'æ»‘å†°'},
                            {icon: 'ğŸ‡', text: 'Hop', word: 'hop', meaning: 'è·³è·ƒ'},
                            {icon: 'ğŸš²', text: 'Ride bicycle', word: 'ride', meaning: 'éª‘è‡ªè¡Œè½¦'},
                            {icon: 'ğŸ¥—', text: 'Salad', word: 'salad', meaning: 'æ²™æ‹‰'},
                            {icon: 'ğŸ¥•', text: 'Carrot', word: 'carrot', meaning: 'èƒ¡èåœ'},
                            {icon: 'ğŸŸ', text: 'Fish', word: 'fish', meaning: 'é±¼'},
                            {icon: 'ğŸ—', text: 'Chicken', word: 'chicken', meaning: 'é¸¡è‚‰'},
                            {icon: 'ğŸŒ', text: 'Banana', word: 'banana', meaning: 'é¦™è•‰'},
                            {icon: 'ğŸ¦’', text: 'Giraffe', word: 'giraffe', meaning: 'é•¿é¢ˆé¹¿'},
                            {icon: 'ğŸ', text: 'Snake', word: 'snake', meaning: 'è›‡'},
                            {icon: 'ğŸ˜', text: 'Elephant', word: 'elephant', meaning: 'å¤§è±¡'},
                            {icon: 'ğŸ¦“', text: 'Zebra', word: 'zebra', meaning: 'æ–‘é©¬'},
                            {icon: 'ğŸ¼', text: 'Panda', word: 'panda', meaning: 'ç†ŠçŒ«'},
                            // æ–°å¢å•è¯å¡ç‰‡
                            {icon: 'ğŸ¤¸', text: 'Jump', word: 'jump', meaning: 'è·³è·ƒ'},
                            {icon: 'ğŸ§—', text: 'Climb', word: 'climb', meaning: 'æ”€çˆ¬'},
                            {icon: 'ğŸ¤', text: 'Sing', word: 'sing', meaning: 'å”±æ­Œ'},
                            {icon: 'ğŸ’ƒ', text: 'Dance', word: 'dance', meaning: 'è·³èˆ'},
                            {icon: 'ğŸ“–', text: 'Read', word: 'read', meaning: 'é˜…è¯»'},
                            {icon: 'ğŸ', text: 'Eat', word: 'eat', meaning: 'åƒ'}
                        ],
                        dialogs: [
                            {
                                question: "Can you swim?",
                                answers: [
                                    {text: "Yes, I can swim.", correct: true},
                                    {text: "No, I can't swim.", correct: false},
                                    {text: "I like swimming.", correct: false}
                                ]
                            },
                            {
                                question: "Do you like bananas?",
                                answers: [
                                    {text: "Yes, I like bananas.", correct: true},
                                    {text: "I can skate.", correct: false},
                                    {text: "It's a banana.", correct: false}
                                ]
                            },
                            {
                                question: "What can you do?",
                                answers: [
                                    {text: "I can run and jump.", correct: true},
                                    {text: "I like pizza.", correct: false},
                                    {text: "I'm a supergirl.", correct: false}
                                ]
                            }
                        ],
                        spelling: [
                            {hint: "è·‘æ­¥", word: "run"},
                            {hint: "æ¸¸æ³³", word: "swim"},
                            {hint: "é¦™è•‰", word: "banana"},
                            {hint: "ç†ŠçŒ«", word: "panda"},
                            {hint: "é•¿é¢ˆé¹¿", word: "giraffe"},
                            {hint: "å†™å­—", word: "write"},
                            {hint: "è·³èˆ", word: "dance"},
                            {hint: "æ”€çˆ¬", word: "climb"}
                        ],
                        fillIn: [
                            {
                                sentence: "I can ____ fast.",
                                options: ["run", "swim", "fly", "write"],
                                correct: "run"
                            },
                            {
                                sentence: "The ____ is tall.",
                                options: ["giraffe", "panda", "elephant", "zebra"],
                                correct: "giraffe"
                            },
                            {
                                sentence: "Do you like ____?",
                                options: ["bananas", "apples", "oranges", "grapes"],
                                correct: "bananas"
                            }
                        ]
                    },
                    3: {
                        title: "Unit 3: ç‰©å“ä¸ä½ç½®",
                        vocab: [
                            {icon: 'ğŸ›', text: 'Slide', word: 'slide', meaning: 'æ»‘æ¢¯'},
                            {icon: 'ğŸ§¸', text: 'Teddy bear', word: 'bear', meaning: 'æ³°è¿ªç†Š'},
                            {icon: 'ğŸ’º', text: 'Chair', word: 'chair', meaning: 'æ¤…å­'},
                            {icon: 'ğŸ“¦', text: 'Box', word: 'box', meaning: 'ç›’å­'},
                            {icon: 'ğŸ¥£', text: 'Bowl', word: 'bowl', meaning: 'ç¢—'},
                            {icon: 'ğŸ¥¢', text: 'Chopsticks', word: 'chopsticks', meaning: 'ç­·å­'},
                            {icon: 'ğŸ“', text: 'Ruler', word: 'ruler', meaning: 'å°ºå­'},
                            {icon: 'âœï¸', text: 'Pencil', word: 'pencil', meaning: 'é“…ç¬”'},
                            {icon: 'ğŸ‚', text: 'Autumn', word: 'autumn', meaning: 'ç§‹å¤©'},
                            {icon: 'â„ï¸', text: 'Winter', word: 'winter', meaning: 'å†¬å¤©'},
                            {icon: 'ğŸ˜', text: 'Cool', word: 'cool', meaning: 'å‡‰çˆ½'},
                            {icon: 'ğŸ¥¶', text: 'Cold', word: 'cold', meaning: 'å¯’å†·'},
                            {icon: 'â˜€ï¸', text: 'Sunny', word: 'sunny', meaning: 'æ™´æœ—'},
                            {icon: 'ğŸŒ¬ï¸', text: 'Windy', word: 'windy', meaning: 'æœ‰é£'},
                            {icon: 'ğŸš¦', text: 'Traffic light', word: 'light', meaning: 'çº¢ç»¿ç¯'},
                            {icon: 'ğŸ‘–', text: 'Trousers', word: 'trousers', meaning: 'è£¤å­'},
                            {icon: 'ğŸ§¥', text: 'Coat', word: 'coat', meaning: 'å¤–å¥—'},
                            // æ–°å¢å•è¯å¡ç‰‡
                            {icon: 'ğŸª‘', text: 'Desk', word: 'desk', meaning: 'ä¹¦æ¡Œ'},
                            {icon: 'ğŸ“š', text: 'Book', word: 'book', meaning: 'ä¹¦'},
                            {icon: 'ğŸ–Šï¸', text: 'Pen', word: 'pen', meaning: 'é’¢ç¬”'},
                            {icon: 'ğŸ’', text: 'Bag', word: 'bag', meaning: 'ä¹¦åŒ…'},
                            {icon: 'ğŸ§½', text: 'Rubber', word: 'rubber', meaning: 'æ©¡çš®'},
                            {icon: 'âœï¸', text: 'Sharpener', word: 'sharpener', meaning: 'å‰Šç¬”åˆ€'}
                        ],
                        dialogs: [
                            {
                                question: "Where is the book?",
                                answers: [
                                    {text: "It's on the table.", correct: true},
                                    {text: "It's a book.", correct: false},
                                    {text: "I like reading.", correct: false}
                                ]
                            },
                            {
                                question: "How is the weather today?",
                                answers: [
                                    {text: "It's sunny and warm.", correct: true},
                                    {text: "I like sunny days.", correct: false},
                                    {text: "It's a sunny day.", correct: false}
                                ]
                            },
                            {
                                question: "What do you wear in winter?",
                                answers: [
                                    {text: "I wear a coat and trousers.", correct: true},
                                    {text: "I like winter.", correct: false},
                                    {text: "It's cold in winter.", correct: false}
                                ]
                            }
                        ],
                        spelling: [
                            {hint: "æ¤…å­", word: "chair"},
                            {hint: "é“…ç¬”", word: "pencil"},
                            {hint: "å°ºå­", word: "ruler"},
                            {hint: "ç§‹å¤©", word: "autumn"},
                            {hint: "å†¬å¤©", word: "winter"},
                            {hint: "å¤–å¥—", word: "coat"},
                            {hint: "ä¹¦æ¡Œ", word: "desk"},
                            {hint: "ä¹¦åŒ…", word: "bag"}
                        ],
                        fillIn: [
                            {
                                sentence: "The book is on the ____.",
                                options: ["table", "chair", "box", "floor"],
                                correct: "table"
                            },
                            {
                                sentence: "It is ____ in winter.",
                                options: ["cold", "hot", "warm", "cool"],
                                correct: "cold"
                            },
                            {
                                sentence: "I wear a ____ in winter.",
                                options: ["coat", "T-shirt", "shorts", "skirt"],
                                correct: "coat"
                            }
                        ]
                    },
                    4: {
                        title: "Unit 4: è‡ªç„¶ä¸åŠ¨ç‰©",
                        vocab: [
                            {icon: 'â˜€ï¸', text: 'Sun', word: 'sun', meaning: 'å¤ªé˜³'},
                            {icon: 'ğŸŒ™', text: 'Moon', word: 'moon', meaning: 'æœˆäº®'},
                            {icon: 'â­', text: 'Star', word: 'star', meaning: 'æ˜Ÿæ˜Ÿ'},
                            {icon: 'ğŸ¦Š', text: 'Fox', word: 'fox', meaning: 'ç‹ç‹¸'},
                            {icon: 'ğŸ¦›', text: 'Hippo', word: 'hippo', meaning: 'æ²³é©¬'},
                            {icon: 'ğŸ‡', text: 'Rabbit', word: 'rabbit', meaning: 'å…”å­'},
                            {icon: 'ğŸµ', text: 'Monkey', word: 'monkey', meaning: 'çŒ´å­'},
                            {icon: 'ğŸ', text: 'Bee', word: 'bee', meaning: 'èœœèœ‚'},
                            {icon: 'âš½', text: 'Football', word: 'football', meaning: 'è¶³çƒ'},
                            {icon: 'ğŸ€', text: 'Basketball', word: 'basketball', meaning: 'ç¯®çƒ'},
                            {icon: 'ğŸˆ', text: 'Balloon', word: 'balloon', meaning: 'æ°”çƒ'},
                            {icon: 'ğŸ¥ª', text: 'Bread', word: 'bread', meaning: 'é¢åŒ…'},
                            {icon: 'ğŸ¥›', text: 'Milk', word: 'milk', meaning: 'ç‰›å¥¶'},
                            {icon: 'ğŸ˜‹', text: 'Hungry', word: 'hungry', meaning: 'é¥¥é¥¿'},
                            {icon: 'ğŸ¥¤', text: 'Thirsty', word: 'thirsty', meaning: 'å£æ¸´'},
                            {icon: 'ğŸ¨', text: 'Drawing', word: 'drawing', meaning: 'ç”»ç”»'},
                            {icon: 'ğŸ“š', text: 'Reading', word: 'reading', meaning: 'é˜…è¯»'},
                            // æ–°å¢å•è¯å¡ç‰‡
                            {icon: 'ğŸŒ³', text: 'Tree', word: 'tree', meaning: 'æ ‘'},
                            {icon: 'ğŸŒ¸', text: 'Flower', word: 'flower', meaning: 'èŠ±'},
                            {icon: 'ğŸŒ¿', text: 'Grass', word: 'grass', meaning: 'è‰'},
                            {icon: 'ğŸ¦', text: 'Bird', word: 'bird', meaning: 'é¸Ÿ'},
                            {icon: 'ğŸ¦‹', text: 'Butterfly', word: 'butterfly', meaning: 'è´è¶'},
                            {icon: 'â˜ï¸', text: 'Cloud', word: 'cloud', meaning: 'äº‘'}
                        ],
                        dialogs: [
                            {
                                question: "Can you see the moon?",
                                answers: [
                                    {text: "Yes, I can see the moon.", correct: true},
                                    {text: "No, I can't see the moon.", correct: false},
                                    {text: "The moon is big.", correct: false}
                                ]
                            },
                            {
                                question: "What do you like?",
                                answers: [
                                    {text: "I like playing basketball.", correct: true},
                                    {text: "I can play basketball.", correct: false},
                                    {text: "Basketball is fun.", correct: false}
                                ]
                            },
                            {
                                question: "Are you hungry?",
                                answers: [
                                    {text: "Yes, I'm hungry. I want bread.", correct: true},
                                    {text: "I like bread.", correct: false},
                                    {text: "Bread is delicious.", correct: false}
                                ]
                            }
                        ],
                        spelling: [
                            {hint: "å¤ªé˜³", word: "sun"},
                            {hint: "æœˆäº®", word: "moon"},
                            {hint: "å…”å­", word: "rabbit"},
                            {hint: "çŒ´å­", word: "monkey"},
                            {hint: "é¢åŒ…", word: "bread"},
                            {hint: "ç‰›å¥¶", word: "milk"},
                            {hint: "æ ‘", word: "tree"},
                            {hint: "èŠ±", word: "flower"}
                        ],
                        fillIn: [
                            {
                                sentence: "The ____ is hot.",
                                options: ["sun", "moon", "star", "cloud"],
                                correct: "sun"
                            },
                            {
                                sentence: "I like to play ____.",
                                options: ["basketball", "football", "tennis", "volleyball"],
                                correct: "basketball"
                            },
                            {
                                sentence: "I am ____. I want bread.",
                                options: ["hungry", "thirsty", "tired", "happy"],
                                correct: "hungry"
                            }
                        ]
                    }
                }
            };
            
            // åˆå§‹åŒ–æ¸¸æˆ
            function initGame() {
                // æ£€æŸ¥è¯­éŸ³æ”¯æŒ
                if (!speechSupported) {
                    voiceStatus.classList.add('muted');
                    statusText.textContent = "è¯­éŸ³åŠŸèƒ½ä¸å¯ç”¨";
                    voiceAnimation.style.display = 'none';
                    feedbackEl.textContent = "å½“å‰ç¯å¢ƒä¸æ”¯æŒè¯­éŸ³åŠŸèƒ½";
                    feedbackEl.className = "feedback incorrect";
                }
                
                // å•å…ƒé€‰æ‹©äº‹ä»¶
                unitButtons.forEach(button => {
                    button.addEventListener('click', function() {
                        unitButtons.forEach(btn => btn.classList.remove('active'));
                        this.classList.add('active');
                        
                        currentUnit = this.getAttribute('data-unit');
                        loadUnit(currentUnit);
                    });
                });
                
                // æ¨¡å¼é€‰æ‹©äº‹ä»¶
                modeButtons.forEach(button => {
                    button.addEventListener('click', function() {
                        modeButtons.forEach(btn => btn.classList.remove('active'));
                        this.classList.add('active');
                        
                        currentMode = this.getAttribute('data-mode');
                        loadMode(currentMode);
                    });
                });
                
                // è¯­éŸ³æŒ‰é’®äº‹ä»¶
                speakerBtn.addEventListener('click', function() {
                    if (currentMode === 'vocab') {
                        // åœ¨å•è¯æ¨¡å¼ä¸‹ï¼Œæœ—è¯»é—®é¢˜
                        speakText(questionEl.textContent);
                    } else {
                        // åœ¨å¯¹è¯æ¨¡å¼ä¸‹ï¼Œæœ—è¯»é—®é¢˜
                        speakText(questionEl.textContent);
                    }
                });
                
                // æ‹¼å†™æ£€æŸ¥æŒ‰é’®
                checkSpellingBtn.addEventListener('click', checkSpelling);
                
                // è·³è¿‡æ‹¼å†™æŒ‰é’®
                skipSpellingBtn.addEventListener('click', nextSpelling);
                
                // åˆå§‹åŠ è½½
                loadUnit(1);
                updateUserInfo();
            }
            
            // åŠ è½½å•å…ƒå†…å®¹
            function loadUnit(unitNumber) {
                const unit = gameData.units[unitNumber];
                document.querySelector('.game-title').textContent = unit.title;
                
                // é‡ç½®è¿›åº¦
                progressBar.style.width = "0%";
                feedbackEl.textContent = "";
                feedbackEl.className = "feedback";
                
                // åŠ è½½å½“å‰æ¨¡å¼å†…å®¹
                loadMode(currentMode);
            }
            
            // åŠ è½½æ¨¡å¼å†…å®¹
            function loadMode(mode) {
                const unit = gameData.units[currentUnit];
                
                // éšè—æ‰€æœ‰ç‰¹æ®Šå®¹å™¨
                spellingContainer.style.display = 'none';
                fillContainer.style.display = 'none';
                document.getElementById('dialogBox').style.display = 'block';
                cardGrid.style.display = 'grid';
                
                if (mode === 'vocab') {
                    // è¯æ±‡å­¦ä¹ æ¨¡å¼
                    loadVocabMode(unit.vocab);
                } else if (mode === 'dialog') {
                    // å¯¹è¯ç»ƒä¹ æ¨¡å¼
                    loadDialogMode(unit.dialogs);
                } else if (mode === 'game') {
                    // æ¸¸æˆæ¨¡å¼
                    loadGameMode(unit.vocab);
                } else if (mode === 'spelling') {
                    // å•è¯æ‹¼å†™æ¨¡å¼
                    loadSpellingMode(unit.spelling);
                    document.getElementById('dialogBox').style.display = 'none';
                    cardGrid.style.display = 'none';
                } else if (mode === 'fill-in') {
                    // å¥å‹å¡«ç©ºæ¨¡å¼
                    loadFillInMode(unit.fillIn);
                    document.getElementById('dialogBox').style.display = 'none';
                    cardGrid.style.display = 'none';
                }
            }
            
            // åŠ è½½è¯æ±‡å­¦ä¹ æ¨¡å¼
            function loadVocabMode(vocabList) {
                cardGrid.innerHTML = '';
                questionEl.textContent = "ç‚¹å‡»å¡ç‰‡å­¦ä¹ å•è¯å‘éŸ³";
                answerOptionsEl.innerHTML = '';
                
                vocabList.forEach(item => {
                    const cardElement = document.createElement('div');
                    cardElement.className = 'card';
                    cardElement.innerHTML = `
                        <div class="card-inner">
                            <div class="card-front">
                                <div class="card-icon">${item.icon}</div>
                                <div class="card-text">${item.text}</div>
                                <div class="card-tag">ç‚¹å‡»ç¿»è½¬</div>
                            </div>
                            <div class="card-back">
                                <div class="card-icon">ğŸ“–</div>
                                <div class="card-text">${item.meaning}</div>
                            </div>
                        </div>
                    `;
                    cardElement.addEventListener('click', function() {
                        this.classList.toggle('flipped');
                        speakWord(item.word);
                        
                        // å¢åŠ ç§¯åˆ†
                        userScore += 5;
                        updateUserInfo();
                    });
                    cardGrid.appendChild(cardElement);
                });
            }
            
            // åŠ è½½å¯¹è¯ç»ƒä¹ æ¨¡å¼
            function loadDialogMode(dialogs) {
                cardGrid.innerHTML = '';
                
                // éšæœºé€‰æ‹©ä¸€ä¸ªå¯¹è¯
                const randomDialog = dialogs[Math.floor(Math.random() * dialogs.length)];
                questionEl.textContent = randomDialog.question;
                
                // æ¸…ç©ºç­”æ¡ˆé€‰é¡¹
                answerOptionsEl.innerHTML = '';
                
                // æ·»åŠ ç­”æ¡ˆé€‰é¡¹
                randomDialog.answers.forEach(answer => {
                    const button = document.createElement('button');
                    button.className = 'answer-btn';
                    button.textContent = answer.text;
                    button.dataset.correct = answer.correct;
                    button.addEventListener('click', function() {
                        checkAnswer(this.dataset.correct === 'true');
                    });
                    answerOptionsEl.appendChild(button);
                });
                
                // æœ—è¯»é—®é¢˜
                speakText(randomDialog.question);
            }
            
            // åŠ è½½æ¸¸æˆæ¨¡å¼
            function loadGameMode(vocabList) {
                // æ¸…ç©ºå¡ç‰‡ç½‘æ ¼
                cardGrid.innerHTML = '';
                
                // åˆ›å»ºåŒ¹é…æ¸¸æˆ
                const gameWords = [];
                for (let i = 0; i < 8; i++) {
                    const wordIndex = Math.floor(Math.random() * vocabList.length);
                    const word = vocabList[wordIndex];
                    gameWords.push(word);
                }
                
                // å¤åˆ¶å•è¯ä»¥åˆ›å»ºé…å¯¹
                const allWords = [...gameWords, ...gameWords];
                
                // æ‰“ä¹±é¡ºåº
                allWords.sort(() => Math.random() - 0.5);
                
                // åˆ›å»ºå¡ç‰‡
                allWords.forEach((word, index) => {
                    const cardElement = document.createElement('div');
                    cardElement.className = 'card';
                    cardElement.dataset.word = word.word;
                    cardElement.dataset.index = index;
                    cardElement.innerHTML = `
                        <div class="card-icon">â“</div>
                    `;
                    
                    cardElement.addEventListener('click', function() {
                        revealCard(this, word);
                    });
                    
                    cardGrid.appendChild(cardElement);
                });
                
                questionEl.textContent = "æ‰¾åˆ°åŒ¹é…çš„å•è¯å¡ç‰‡";
            }
            
            // åŠ è½½æ‹¼å†™æ¨¡å¼
            function loadSpellingMode(spellingList) {
                spellingContainer.style.display = 'block';
                spellingInput.value = '';
                spellingHint.textContent = '';
                
                // éšæœºé€‰æ‹©ä¸€ä¸ªå•è¯
                const randomIndex = Math.floor(Math.random() * spellingList.length);
                currentSpellingWord = spellingList[randomIndex];
                
                spellingPrompt.textContent = `è¯·æ‹¼å†™å•è¯: ${currentSpellingWord.hint}`;
                spellingHint.textContent = `å•è¯é•¿åº¦: ${currentSpellingWord.word.length} ä¸ªå­—æ¯`;
                
                // æœ—è¯»æç¤º
                speakText(`è¯·æ‹¼å†™å•è¯: ${currentSpellingWord.hint}`);
                
                // èšç„¦è¾“å…¥æ¡†
                setTimeout(() => {
                    spellingInput.focus();
                }, 100);
            }
            
            // æ£€æŸ¥æ‹¼å†™
            function checkSpelling() {
                const userInput = spellingInput.value.trim().toLowerCase();
                
                if (userInput === currentSpellingWord.word) {
                    // æ‹¼å†™æ­£ç¡®
                    feedbackEl.textContent = 'å¤ªæ£’äº†ï¼æ‹¼å†™æ­£ç¡®ï¼';
                    feedbackEl.className = 'feedback correct';
                    speakText('Correct! Well done!');
                    
                    // å¢åŠ ç§¯åˆ†
                    userScore += 15;
                    updateUserInfo();
                    
                    // æ›´æ–°è¿›åº¦æ¡
                    const currentWidth = parseInt(progressBar.style.width);
                    progressBar.style.width = (currentWidth + 15) + '%';
                    
                    // åŠ è½½ä¸‹ä¸€ä¸ªå•è¯
                    setTimeout(nextSpelling, 1500);
                } else {
                    // æ‹¼å†™é”™è¯¯
                    feedbackEl.textContent = 'å†è¯•ä¸€æ¬¡ï¼ä½ å¯ä»¥çš„ï¼';
                    feedbackEl.className = 'feedback incorrect';
                    speakText('Almost! Try again!');
                    
                    // æ·»åŠ æŠ–åŠ¨æ•ˆæœ
                    spellingInput.classList.add('shake');
                    setTimeout(() => {
                        spellingInput.classList.remove('shake');
                    }, 500);
                    
                    // èšç„¦è¾“å…¥æ¡†
                    spellingInput.focus();
                }
            }
            
            // ä¸‹ä¸€ä¸ªæ‹¼å†™å•è¯
            function nextSpelling() {
                const unit = gameData.units[currentUnit];
                loadSpellingMode(unit.spelling);
                feedbackEl.textContent = '';
                feedbackEl.className = 'feedback';
            }
            
            // åŠ è½½å¡«ç©ºæ¨¡å¼
            function loadFillInMode(fillInList) {
                fillContainer.style.display = 'block';
                fillOptions.innerHTML = '';
                
                // éšæœºé€‰æ‹©ä¸€ä¸ªå¡«ç©ºé—®é¢˜
                const randomIndex = Math.floor(Math.random() * fillInList.length);
                currentFillQuestion = fillInList[randomIndex];
                
                // æ˜¾ç¤ºå¥å­
                sentenceText.innerHTML = currentFillQuestion.sentence.replace('____', '<span class="blank"><span class="blank-answer"></span>____</span>');
                
                // æ·»åŠ é€‰é¡¹
                currentFillQuestion.options.forEach(option => {
                    const optionBtn = document.createElement('button');
                    optionBtn.className = 'fill-option';
                    optionBtn.textContent = option;
                    optionBtn.addEventListener('click', function() {
                        // ç§»é™¤å…¶ä»–é€‰é¡¹çš„é€‰ä¸­çŠ¶æ€
                        document.querySelectorAll('.fill-option').forEach(btn => {
                            btn.classList.remove('selected');
                        });
                        
                        // é€‰ä¸­å½“å‰é€‰é¡¹
                        this.classList.add('selected');
                        
                        // åœ¨ç©ºç™½å¤„æ˜¾ç¤ºç­”æ¡ˆ
                        document.querySelector('.blank-answer').textContent = option;
                        
                        // æ£€æŸ¥ç­”æ¡ˆ
                        checkFillAnswer(option);
                    });
                    fillOptions.appendChild(optionBtn);
                });
                
                // æœ—è¯»å¥å­
                speakText(currentFillQuestion.sentence.replace('____', 'ç©ºç™½'));
            }
            
            // æ£€æŸ¥å¡«ç©ºç­”æ¡ˆ
            function checkFillAnswer(userAnswer) {
                if (userAnswer === currentFillQuestion.correct) {
                    // ç­”æ¡ˆæ­£ç¡®
                    feedbackEl.textContent = 'å¤ªæ£’äº†ï¼å›ç­”æ­£ç¡®ï¼';
                    feedbackEl.className = 'feedback correct';
                    speakText('Correct! Well done!');
                    
                    // å¢åŠ ç§¯åˆ†
                    userScore += 12;
                    updateUserInfo();
                    
                    // æ›´æ–°è¿›åº¦æ¡
                    const currentWidth = parseInt(progressBar.style.width);
                    progressBar.style.width = (currentWidth + 12) + '%';
                    
                    // åŠ è½½ä¸‹ä¸€ä¸ªé—®é¢˜
                    setTimeout(nextFillQuestion, 1500);
                } else {
                    // ç­”æ¡ˆé”™è¯¯
                    feedbackEl.textContent = 'å†æƒ³ä¸€æƒ³ï¼';
                    feedbackEl.className = 'feedback incorrect';
                    speakText('Almost! Try again!');
                }
            }
            
            // ä¸‹ä¸€ä¸ªå¡«ç©ºé—®é¢˜
            function nextFillQuestion() {
                const unit = gameData.units[currentUnit];
                loadFillInMode(unit.fillIn);
                feedbackEl.textContent = '';
                feedbackEl.className = 'feedback';
            }
            
            // æ¸¸æˆæ¨¡å¼ï¼šæ˜¾ç¤ºå¡ç‰‡
            let firstCard = null;
            let secondCard = null;
            let lockBoard = false;
            
            function revealCard(card, word) {
                if (lockBoard) return;
                if (card === firstCard) return;
                
                card.innerHTML = `
                    <div class="card-icon">${word.icon}</div>
                    <div class="card-text">${word.text}</div>
                `;
                
                if (!firstCard) {
                    firstCard = card;
                    return;
                }
                
                secondCard = card;
                lockBoard = true;
                
                // æ£€æŸ¥æ˜¯å¦åŒ¹é…
                if (firstCard.dataset.word === secondCard.dataset.word) {
                    // åŒ¹é…æˆåŠŸ
                    setTimeout(() => {
                        firstCard.style.visibility = 'hidden';
                        secondCard.style.visibility = 'hidden';
                        resetBoard();
                        
                        // å¢åŠ ç§¯åˆ†
                        userScore += 10;
                        updateUserInfo();
                        
                        // æ›´æ–°è¿›åº¦
                        const currentWidth = parseInt(progressBar.style.width);
                        progressBar.style.width = (currentWidth + 10) + '%';
                        
                        // æ£€æŸ¥æ¸¸æˆæ˜¯å¦ç»“æŸ
                        checkGameCompletion();
                    }, 1000);
                } else {
                    // ä¸åŒ¹é…
                    setTimeout(() => {
                        firstCard.innerHTML = '<div class="card-icon">â“</div>';
                        secondCard.innerHTML = '<div class="card-icon">â“</div>';
                        resetBoard();
                    }, 1500);
                }
            }
            
            function resetBoard() {
                [firstCard, secondCard, lockBoard] = [null, null, false];
            }
            
            function checkGameCompletion() {
                const cards = document.querySelectorAll('.card');
                const hiddenCards = document.querySelectorAll('.card[style*="visibility: hidden"]');
                
                if (cards.length === hiddenCards.length) {
                    feedbackEl.textContent = "æ­å–œä½ å®Œæˆæ¸¸æˆï¼";
                    feedbackEl.className = "feedback correct";
                    
                    // å¢åŠ ç§¯åˆ†
                    userScore += 50;
                    updateUserInfo();
                    
                    // å‡çº§
                    userLevel++;
                    updateUserInfo();
                }
            }
            
            // æ£€æŸ¥ç­”æ¡ˆ
            function checkAnswer(isCorrect) {
                if (isCorrect) {
                    feedbackEl.textContent = 'Good job! You got it right!';
                    feedbackEl.className = 'feedback correct';
                    speakText('Correct! Well done!');
                    
                    // å¢åŠ ç§¯åˆ†
                    userScore += 10;
                    updateUserInfo();
                } else {
                    feedbackEl.textContent = 'Try again! You can do it!';
                    feedbackEl.className = 'feedback incorrect';
                    speakText('Almost! Try again!');
                }
                
                // æ›´æ–°è¿›åº¦æ¡
                const currentWidth = parseInt(progressBar.style.width);
                progressBar.style.width = (currentWidth + 10) + '%';
                
                // å¦‚æœè¿›åº¦å®Œæˆ
                if (currentWidth >= 95) {
                    setTimeout(() => {
                        feedbackEl.textContent = 'Congratulations! Unit completed!';
                        feedbackEl.className = 'feedback correct';
                        speakText('Congratulations! You finished this unit!');
                        
                        // å‡çº§
                        userLevel++;
                        updateUserInfo();
                    }, 1000);
                }
                
                // åŠ è½½æ–°é—®é¢˜
                setTimeout(() => {
                    const unit = gameData.units[currentUnit];
                    loadDialogMode(unit.dialogs);
                }, 1500);
            }
            
            // æ›´æ–°ç”¨æˆ·ä¿¡æ¯
            function updateUserInfo() {
                scoreEl.textContent = userScore;
                
                // æ ¹æ®ç§¯åˆ†è®¾ç½®ç­‰çº§
                if (userScore < 50) {
                    levelEl.textContent = "åˆçº§";
                } else if (userScore < 150) {
                    levelEl.textContent = "ä¸­çº§";
                } else {
                    levelEl.textContent = "é«˜çº§";
                }
            }
            
            // æœ—è¯»å•è¯
            function speakWord(word) {
                const wordMap = {
                    'morning': 'Good morning',
                    'afternoon': 'Good afternoon',
                    'evening': 'Good evening',
                    'night': 'Good night',
                    'fine': "I'm fine",
                    'excellent': "I'm excellent",
                    'boy': 'boy',
                    'girl': 'girl',
                    'run': 'run',
                    'write': 'write',
                    'swim': 'swim',
                    'fly': 'fly',
                    'supergirl': 'supergirl',
                    'ride': 'ride a bicycle',
                    'slide': 'slide',
                    'bear': 'teddy bear',
                    'chair': 'chair',
                    'box': 'box',
                    'bowl': 'bowl',
                    'chopsticks': 'chopsticks',
                    'ruler': 'ruler',
                    'pencil': 'pencil',
                    'sun': 'sun',
                    'moon': 'moon',
                    'star': 'star',
                    'fox': 'fox',
                    'hippo': 'hippo',
                    'rabbit': 'rabbit',
                    'monkey': 'monkey',
                    'bee': 'bee',
                    'one': 'one',
                    'two': 'two',
                    'three': 'three',
                    'four': 'four',
                    'five': 'five',
                    'six': 'six',
                    'seven': 'seven',
                    'eight': 'eight',
                    'nine': 'nine',
                    'ten': 'ten',
                    'white': 'white',
                    'purple': 'purple',
                    'pink': 'pink',
                    'orange': 'orange',
                    'brown': 'brown',
                    'black': 'black',
                    // æ–°å¢å•è¯
                    'red': 'red',
                    'green': 'green',
                    'yellow': 'yellow',
                    'blue': 'blue',
                    'teacher': 'teacher',
                    'student': 'student',
                    'jump': 'jump',
                    'climb': 'climb',
                    'sing': 'sing',
                    'dance': 'dance',
                    'read': 'read',
                    'eat': 'eat',
                    'desk': 'desk',
                    'book': 'book',
                    'pen': 'pen',
                    'bag': 'bag',
                    'rubber': 'rubber',
                    'sharpener': 'sharpener',
                    'tree': 'tree',
                    'flower': 'flower',
                    'grass': 'grass',
                    'bird': 'bird',
                    'butterfly': 'butterfly',
                    'cloud': 'cloud'
                };
                
                const text = wordMap[word] || word;
                speakText(text);
            }
            
            // æœ—è¯»æ–‡æœ¬
            function speakText(text) {
                if (!speechSupported) {
                    feedbackEl.textContent = "å½“å‰ç¯å¢ƒä¸æ”¯æŒè¯­éŸ³åŠŸèƒ½";
                    feedbackEl.className = "feedback incorrect";
                    return;
                }
                
                try {
                    // å–æ¶ˆå½“å‰æ­£åœ¨æ’­æ”¾çš„è¯­éŸ³
                    window.speechSynthesis.cancel();
                    isSpeaking = false;
                    
                    const utterance = new SpeechSynthesisUtterance(text);
                    utterance.lang = 'en-US';
                    utterance.rate = 0.9;
                    utterance.pitch = 1.2;
                    
                    // å¼€å§‹è¯­éŸ³æ’­æ”¾
                    isSpeaking = true;
                    voiceStatus.classList.add('speaking');
                    voiceAnimation.style.display = 'flex';
                    
                    utterance.onend = function() {
                        isSpeaking = false;
                        voiceStatus.classList.remove('speaking');
                        voiceAnimation.style.display = 'none';
                    };
                    
                    utterance.onerror = function(event) {
                        console.error("è¯­éŸ³æ’­æ”¾é”™è¯¯:", event);
                        isSpeaking = false;
                        voiceStatus.classList.remove('speaking');
                        voiceAnimation.style.display = 'none';
                        feedbackEl.textContent = "è¯­éŸ³æ’­æ”¾å¤±è´¥ï¼Œè¯·æ£€æŸ¥è®¾ç½®";
                        feedbackEl.className = "feedback incorrect";
                    };
                    
                    window.speechSynthesis.speak(utterance);
                } catch (e) {
                    console.error("è¯­éŸ³åˆæˆé”™è¯¯:", e);
                    feedbackEl.textContent = "è¯­éŸ³åŠŸèƒ½ä¸å¯ç”¨ï¼Œè¯·åœ¨æµè§ˆå™¨ä¸­æ‰“å¼€";
                    feedbackEl.className = "feedback incorrect";
                }
            }
            
            // å¯åŠ¨æ¸¸æˆ
            initGame();
        });
    </script>
</body>
</html>